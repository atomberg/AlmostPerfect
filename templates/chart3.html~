<!DOCTYPE html>
<meta charset="utf-8">

<body>
<script src="static/js/d3.min.js"></script>
<script src="static/js/jquery.min.js"></script>

<div id="barchart1"></div>

<div id="barchart2"></div>


<script>
var data = [];



var canvasWidth = 500;
var svg1 = d3.select('#barchart1')
             .append('svg')
             .attr('width', canvasWidth)
             .attr('height', 240);

var svg2 = d3.select('#barchart2')
             .append('svg')
             .attr('width', 240)
             .attr('height', 240);

function processJSON (result) {
	var data = [];
	for (var i = 0; i < Object.keys(result.tokens).length; i++) {
		data[i] = { token: result.tokens[i], value: result.score[i], link: result.links[i]};
	}
	return data;
}

function drawChart(chart_selector, json_data){
	data = processJSON(result);

	chart_selector.selectAll('rect')
	.data(data).enter().append('rect')
		.attr('y', function(d, i) { return i * 22; })
	      	.attr('x', function(d) { return 150; })
	     	.attr('height', 20)
	      	.attr('width', 0)
		.attr('fill', "Navy")
	    	.transition()
	      	  .delay(function(d, i) { return i * 100; })
	          .duration(200)
	          .attr('width', function(d) { return d.value * 20; });

	chart_selector.selectAll('links')
	.data(data).enter().append('a')
		.attr('xlink:href', function(d) {return d.link;})
		.append('text')
			.attr('y', function(d, i) { return 15 + i * 22; })
			.attr('x', function(d) { return 140; })
			.attr('fill',"Black")
			.text(function(d) { return d.token;})
			.attr("text-anchor", "end")
			.attr('font-size', 18)
			.attr('width', function(d) { return d.value * 20; });

	chart_selector.selectAll('label')
	.data(data).enter().append('text')
		.attr('y', function(d, i) { return 15 + i * 22; })
		.attr('x', function(d) { return 140 + d.value * 20; })
		.attr('fill',"White")
		.text(function(d) { return d.value.toFixed(2);})
		.attr("text-anchor", "end")
		.attr('font-size', 14)
		.attr('font-weight', 700);
}



//$.getJSON("getresults/B009M2YNWI", function(result){ 
	drawChart(svg1, result);
//});





</script>
<script>
	svg2.selectAll('rect')
	    .data(data)
	    .enter()
	    .append('rect')
	      .attr('y', function(d, i) { return i * 22; })
	      .attr('x', 0)
	      .attr('width', 0)
	      .attr('height', 20)
	    .transition()
	      .delay(function(d, i) { return i * 100; })
	      .duration(200)
	//      .attr('x', function(d) { return 100 - d * 20; })
	      .attr('width', function(d) { return d.value * 20; });
</script>
</body>
